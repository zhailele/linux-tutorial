(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{505:function(t,a,s){"use strict";s.r(a);var e=s(14),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"elastic-技术栈之快速入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elastic-技术栈之快速入门"}},[t._v("#")]),t._v(" Elastic 技术栈之快速入门")]),t._v(" "),s("h2",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),s("h3",{attrs:{id:"elk-是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elk-是什么"}},[t._v("#")]),t._v(" ELK 是什么")]),t._v(" "),s("p",[t._v("ELK 是 elastic 公司旗下三款产品 "),s("a",{attrs:{href:"https://www.elastic.co/products/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[t._v("ElasticSearch"),s("OutboundLink")],1),t._v(" 、"),s("a",{attrs:{href:"https://www.elastic.co/products/logstash",target:"_blank",rel:"noopener noreferrer"}},[t._v("Logstash"),s("OutboundLink")],1),t._v(" 、"),s("a",{attrs:{href:"https://www.elastic.co/products/kibana",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kibana"),s("OutboundLink")],1),t._v(" 的首字母组合。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.elastic.co/products/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[t._v("ElasticSearch"),s("OutboundLink")],1),t._v(" 是一个基于 "),s("a",{attrs:{href:"http://lucene.apache.org/core/documentation.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lucene"),s("OutboundLink")],1),t._v(" 构建的开源，分布式，RESTful 搜索引擎。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.elastic.co/products/logstash",target:"_blank",rel:"noopener noreferrer"}},[t._v("Logstash"),s("OutboundLink")],1),t._v(" 传输和处理你的日志、事务或其他数据。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.elastic.co/products/kibana",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kibana"),s("OutboundLink")],1),t._v(" 将 Elasticsearch 的数据分析并渲染为可视化的报表。")]),t._v(" "),s("h3",{attrs:{id:"为什么使用-elk-？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么使用-elk-？"}},[t._v("#")]),t._v(" 为什么使用 ELK ？")]),t._v(" "),s("p",[t._v("对于有一定规模的公司来说，通常会很多个应用，并部署在大量的服务器上。运维和开发人员常常需要通过查看日志来定位问题。如果应用是集群化部署，试想如果登录一台台服务器去查看日志，是多么费时费力。")]),t._v(" "),s("p",[t._v("而通过 ELK 这套解决方案，可以同时实现日志收集、日志搜索和日志分析的功能。")]),t._v(" "),s("h3",{attrs:{id:"elastic-架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elastic-架构"}},[t._v("#")]),t._v(" Elastic 架构")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://www.elastic.co/guide/en/logstash/current/static/images/deploy3.png",alt:"img"}})]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("说明")])]),t._v(" "),s("p",[t._v("以上是 ELK 技术栈的一个架构图。从图中可以清楚的看到数据流向。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.elastic.co/products/beats",target:"_blank",rel:"noopener noreferrer"}},[t._v("Beats"),s("OutboundLink")],1),t._v(" 是单一用途的数据传输平台，它可以将多台机器的数据发送到 Logstash 或 ElasticSearch。但 Beats 并不是不可或缺的一环，所以本文中暂不介绍。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.elastic.co/products/logstash",target:"_blank",rel:"noopener noreferrer"}},[t._v("Logstash"),s("OutboundLink")],1),t._v(" 是一个动态数据收集管道。支持以 TCP/UDP/HTTP 多种方式收集数据（也可以接受 Beats 传输来的数据），并对数据做进一步丰富或提取字段处理。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.elastic.co/products/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[t._v("ElasticSearch"),s("OutboundLink")],1),t._v(" 是一个基于 JSON 的分布式的搜索和分析引擎。作为 ELK 的核心，它集中存储数据。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.elastic.co/products/kibana",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kibana"),s("OutboundLink")],1),t._v(" 是 ELK 的用户界面。它将收集的数据进行可视化展示（各种报表、图形化数据），并提供配置、管理 ELK 的界面。")])]),t._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("h3",{attrs:{id:"准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[t._v("#")]),t._v(" 准备")]),t._v(" "),s("p",[t._v("ELK 要求本地环境中安装了 JDK 。如果不确定是否已安装，可使用下面的命令检查：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("java -version\n")])])]),s("blockquote",[s("p",[s("strong",[t._v("注意")])]),t._v(" "),s("p",[t._v("本文使用的 ELK 是 6.0.0，要求 jdk 版本不低于 JDK8。")]),t._v(" "),s("p",[t._v("友情提示：安装 ELK 时，三个应用请选择统一的版本，避免出现一些莫名其妙的问题。例如：由于版本不统一，导致三个应用间的通讯异常。")])]),t._v(" "),s("h3",{attrs:{id:"elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch"}},[t._v("#")]),t._v(" Elasticsearch")]),t._v(" "),s("p",[t._v("安装步骤如下：")]),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://www.elastic.co/downloads/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[t._v("elasticsearch 官方下载地址"),s("OutboundLink")],1),t._v("下载所需版本包并解压到本地。")]),t._v(" "),s("li",[t._v("运行 "),s("code",[t._v("bin/elasticsearch")]),t._v(" （Windows 上运行 "),s("code",[t._v("bin\\elasticsearch.bat")]),t._v("）")]),t._v(" "),s("li",[t._v("验证运行成功：linux 上可以执行 "),s("code",[t._v("curl http://localhost:9200/")]),t._v(" ；windows 上可以用访问 REST 接口的方式来访问 http://localhost:9200/")])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("说明")])]),t._v(" "),s("p",[t._v("Linux 上可以执行下面的命令来下载压缩包：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.0.0.tar.gz\n")])])]),s("p",[t._v("Mac 上可以执行以下命令来进行安装：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("brew install elasticsearch\n")])])]),s("p",[t._v("Windows 上可以选择 MSI 可执行安装程序，将应用安装到本地。")])]),t._v(" "),s("h3",{attrs:{id:"logstash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logstash"}},[t._v("#")]),t._v(" Logstash")]),t._v(" "),s("p",[t._v("安装步骤如下：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("在 "),s("a",{attrs:{href:"https://www.elastic.co/downloads/logstash",target:"_blank",rel:"noopener noreferrer"}},[t._v("logstash 官方下载地址"),s("OutboundLink")],1),t._v("下载所需版本包并解压到本地。")])]),t._v(" "),s("li",[s("p",[t._v("添加一个 "),s("code",[t._v("logstash.conf")]),t._v(" 文件，指定要使用的插件以及每个插件的设置。举个简单的例子：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('input { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n')])])])]),t._v(" "),s("li",[s("p",[t._v("运行 "),s("code",[t._v("bin/logstash -f logstash.conf")]),t._v(" （Windows 上运行"),s("code",[t._v("bin/logstash.bat -f logstash.conf")]),t._v("）")])])]),t._v(" "),s("h3",{attrs:{id:"kibana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kibana"}},[t._v("#")]),t._v(" Kibana")]),t._v(" "),s("p",[t._v("安装步骤如下：")]),t._v(" "),s("ol",[s("li",[t._v("在 "),s("a",{attrs:{href:"https://www.elastic.co/downloads/kibana",target:"_blank",rel:"noopener noreferrer"}},[t._v("kibana 官方下载地址"),s("OutboundLink")],1),t._v("下载所需版本包并解压到本地。")]),t._v(" "),s("li",[t._v("修改 "),s("code",[t._v("config/kibana.yml")]),t._v(" 配置文件，设置 "),s("code",[t._v("elasticsearch.url")]),t._v(" 指向 Elasticsearch 实例。")]),t._v(" "),s("li",[t._v("运行 "),s("code",[t._v("bin/kibana")]),t._v(" （Windows 上运行 "),s("code",[t._v("bin\\kibana.bat")]),t._v("）")]),t._v(" "),s("li",[t._v("在浏览器上访问 http://localhost:5601")])]),t._v(" "),s("h3",{attrs:{id:"安装-faq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-faq"}},[t._v("#")]),t._v(" 安装 FAQ")]),t._v(" "),s("h4",{attrs:{id:"elasticsearch-不允许以-root-权限来运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-不允许以-root-权限来运行"}},[t._v("#")]),t._v(" elasticsearch 不允许以 root 权限来运行")]),t._v(" "),s("p",[t._v("**问题：**在 Linux 环境中，elasticsearch 不允许以 root 权限来运行。")]),t._v(" "),s("p",[t._v("如果以 root 身份运行 elasticsearch，会提示这样的错误：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("can not run elasticsearch as root\n")])])]),s("p",[t._v("**解决方法：**使用非 root 权限账号运行 elasticsearch")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建用户组")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupadd")]),t._v(" elk\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建新用户，-g elk 设置其用户组为 elk，-p elk 设置其密码为 elk")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useradd")]),t._v(" elk -g elk -p elk\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更改 /opt 文件夹及内部文件的所属用户及组为 elk:elk")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R elk:elk /opt "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 假设你的 elasticsearch 安装在 opt 目录下")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切换账号")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" elk\n")])])]),s("h4",{attrs:{id:"vm-max-map-count-不低于-262144"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vm-max-map-count-不低于-262144"}},[t._v("#")]),t._v(" vm.max_map_count 不低于 262144")]),t._v(" "),s("p",[s("strong",[t._v("问题：")]),s("code",[t._v("vm.max_map_count")]),t._v(" 表示虚拟内存大小，它是一个内核参数。elasticsearch 默认要求 "),s("code",[t._v("vm.max_map_count")]),t._v(" 不低于 262144。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\n")])])]),s("p",[s("strong",[t._v("解决方法：")])]),t._v(" "),s("p",[t._v("你可以执行以下命令，设置 "),s("code",[t._v("vm.max_map_count")]),t._v(" ，但是重启后又会恢复为原值。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sysctl -w vm.max_map_count=262144\n")])])]),s("p",[t._v("持久性的做法是在 "),s("code",[t._v("/etc/sysctl.conf")]),t._v(" 文件中修改 "),s("code",[t._v("vm.max_map_count")]),t._v("  参数：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('echo "vm.max_map_count=262144" > /etc/sysctl.conf\nsysctl -p\n')])])]),s("blockquote",[s("p",[s("strong",[t._v("注意")])]),t._v(" "),s("p",[t._v("如果运行环境为 docker 容器，可能会限制执行 sysctl 来修改内核参数。")]),t._v(" "),s("p",[t._v("这种情况下，你只能选择直接修改宿主机上的参数了。")])]),t._v(" "),s("h4",{attrs:{id:"nofile-不低于-65536"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nofile-不低于-65536"}},[t._v("#")]),t._v(" nofile 不低于 65536")]),t._v(" "),s("p",[s("strong",[t._v("问题：")]),t._v(" "),s("code",[t._v("nofile")]),t._v(" 表示进程允许打开的最大文件数。elasticsearch 进程要求可以打开的最大文件数不低于 65536。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]\n")])])]),s("p",[s("strong",[t._v("解决方法：")])]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("/etc/security/limits.conf")]),t._v(" 文件中修改 "),s("code",[t._v("nofile")]),t._v(" 参数：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('echo "* soft nofile 65536" > /etc/security/limits.conf\necho "* hard nofile 131072" > /etc/security/limits.conf\n')])])]),s("h4",{attrs:{id:"nproc-不低于-2048"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nproc-不低于-2048"}},[t._v("#")]),t._v(" nproc 不低于 2048")]),t._v(" "),s("p",[s("strong",[t._v("问题：")]),t._v(" "),s("code",[t._v("nproc")]),t._v(" 表示最大线程数。elasticsearch 要求最大线程数不低于 2048。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("max number of threads [1024] for user [user] is too low, increase to at least [2048]\n")])])]),s("p",[s("strong",[t._v("解决方法：")])]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("/etc/security/limits.conf")]),t._v(" 文件中修改 "),s("code",[t._v("nproc")]),t._v(" 参数：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('echo "* soft nproc 2048" > /etc/security/limits.conf\necho "* hard nproc 4096" > /etc/security/limits.conf\n')])])]),s("h4",{attrs:{id:"kibana-no-default-index-pattern-warning"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kibana-no-default-index-pattern-warning"}},[t._v("#")]),t._v(" Kibana No Default Index Pattern Warning")]),t._v(" "),s("p",[t._v("**问题：**安装 ELK 后，访问 kibana 页面时，提示以下错误信息：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Warning No default index pattern. You must select or create one to continue.\n...\nUnable to fetch mapping. Do you have indices matching the pattern?\n")])])]),s("p",[t._v("这就说明 logstash 没有把日志写入到 elasticsearch。")]),t._v(" "),s("p",[s("strong",[t._v("解决方法：")])]),t._v(" "),s("p",[t._v("检查 logstash 与 elasticsearch 之间的通讯是否有问题，一般问题就出在这。")]),t._v(" "),s("h2",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),s("p",[t._v("本人使用的 Java 日志方案为 slf4j + logback，所以这里以 logback 来讲解。")]),t._v(" "),s("h3",{attrs:{id:"java-应用输出日志到-elk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-应用输出日志到-elk"}},[t._v("#")]),t._v(" Java 应用输出日志到 ELK")]),t._v(" "),s("p",[s("strong",[t._v("修改 logstash.conf 配置")])]),t._v(" "),s("p",[t._v("首先，我们需要修改一下 logstash 服务端 logstash.conf 中的配置")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('input { \n  # stdin { }\n  tcp { \n    # host:port就是上面appender中的 destination，\n\t# 这里其实把logstash作为服务，开启9250端口接收logback发出的消息 \n    host => "127.0.0.1" port => 9250 mode => "server" tags => ["tags"] codec => json_lines \n  }\n}\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n')])])]),s("blockquote",[s("p",[s("strong",[t._v("说明")])]),t._v(" "),s("p",[t._v("这个 input 中的配置其实是 logstash 服务端监听 9250 端口，接收传递来的日志数据。")])]),t._v(" "),s("p",[t._v("然后，在 Java 应用的 pom.xml 中引入 jar 包：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("net.logstash.logback"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("logstash-logback-encoder"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("4.11"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("接着，在 logback.xml 中添加 appender")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("appender")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("LOGSTASH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("net.logstash.logback.appender.LogstashTcpSocketAppender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--\n  destination 是 logstash 服务的 host:port，\n  相当于和 logstash 建立了管道，将日志数据定向传输到 logstash\n  --\x3e")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("127.0.0.1:9250"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("encoder")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("net.logstash.logback.encoder.LogstashEncoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("appender")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("logger")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("io.github.dunwu.spring"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("level")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("TRACE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("additivity")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("appender-ref")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ref")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("LOGSTASH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("logger")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("大功告成，此后，"),s("code",[t._v("io.github.dunwu.spring")]),t._v(" 包中的 TRACE 及以上级别的日志信息都会被定向输出到 logstash 服务。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://upload-images.jianshu.io/upload_images/3101171-cd876d79a14955b0.png",alt:"img"}})]),t._v(" "),s("h2",{attrs:{id:"资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[t._v("#")]),t._v(" 资料")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://www.elastic.co/guide/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("elastic 官方文档"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://github.com/elastic/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[t._v("elasticsearch github"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://github.com/elastic/logstash",target:"_blank",rel:"noopener noreferrer"}},[t._v("logstash github"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://github.com/elastic/kibana",target:"_blank",rel:"noopener noreferrer"}},[t._v("kibana github"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=n.exports}}]);